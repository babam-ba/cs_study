---
sidebar_position: 9
---

# 세션 기반 인증과 토큰 기반 인증의 차이
> 세션 기반 인증과 토큰 기반 인증의 차이가 무엇인가요?

## 기억하는 척 하기 위해 사용되는 세션과 토큰
매번 새 페이지를 요청할 때마다 로그인을 해야 한다면 사용이 불가능할 것이다. 이 문제를 해결하기 위해 세션, 토큰을 사용한다.

### 1. 저장 방식
인증 확인 증거를 어디에 저장하냐의 차이이다. 세션 기반 인증은 DB 서버, 토큰 기반 인증은 클라이언트 측에 저장한다.

### 2. 사이즈
`세션 < 토큰`

세션을 사용시 주고 받는 session id의 크기는 매우 작다. 반면 토큰은 같은 데이터를 담고 있어도 그에 비해 크기가 크다.

### 3. 안정성
#### 세션
세션은 서버측에서 저장/관리하기 때문에 상대적으로 온전한 상태를 유지하기 유리하다. but 공격의 위험이 있기에 expire, HttpOnly, Secure 옵션 등을 주어 쿠키에 저장한다.

#### 토큰
토큰은 웹 브라우저에 저장되기 대문에 공격에 노출될 가능성이 크다. 이런 경우를 대비해 토큰에는 민감한 정보를 담지 않는다. 그리고 유효시간을 짧게 설정해 공격에 노출될 수 있는 시간을 최소화한다. but 짧은 주기로 토큰이 무효화되면 서비스 사용자는 계속 로그인을 해줘야 하는 번거로움이 있기 때문에 애초에 로그인 시 refresh token이라는 것을 추가적으로 발급한다.

refresh token은 좀 더 긴 유효기간을 가지며 최대한 안전한 곳에 저장한다. 기존의 토큰이 만료되거나 변질되면 refresh token을 통해 토큰을 재발급한다.

### 4. 확장성
대부분의 웹 서비스가 토큰 방식을 선택하게 된 이유는 바로 확장성이다.

세션은 서버에 저장되기 때문에 다중 접속자가 발생한다면 과부하가 걸릴 수 있다. 그렇다고 서버를 여러 대 두면 세션을 쓰기가 복잡해진다.

HTTP는 stateless, connectionless 하기 때문에 request마다 내가 접속한 서버가 달라질 수도 있다. 이렇게 되면 session 정보가 없는 다른 서버에 접속할 때마다 계속 로그인해줘야 한다. 이런 단점을 해결하기 위해 `sticky session, session clustering`과 같은 방안이 나오기도 했다. 또 이 방안들도 감안해야 할 비용이 발생하기에 이런 걱정 없이 쓸 수 있는 토큰이 인기가 많은 것 같다.

세션용 서버를 따로 두고 쓰는 방법도 있다. 하지만 만일을 대비해 서버를 복제해두어야 한다. 애초에 토큰 방식을 사용한다면 추가 서버 없이 인증/인가를 처리할 수 있다.

## 세션 기반 인증
![세션 기반 인증](https://velog.velcdn.com/images%2Farthur%2Fpost%2Fff3701ad-61e8-4028-ace2-313ae9e2fa7c%2F%EC%84%B8%EC%85%98%EC%9D%B8%EC%A6%9D%EB%B0%A9%EC%8B%9D.png)

> 사용자의 정보를 서버측에서 기억하고 있는 인증 방식

사용자가 인증을 완료하면 서버는 인증 정보를 세션이라고 하는 별도의 공간에 저장하는데, 보통 메모리 혹은 DB에 저장한다. 그리고 사용자가 인증을 완료하면 서버는 인증 정보를 세션에 저장하고, 사용자의 브라우저에는 세션 ID를 쿠키에 저장한다. 그리고 사용자가 다시 서버에 요청을 보낼 때마다 쿠키에 담긴 세션 ID를 서버에 전달한다. 서버는 세션 ID를 통해 사용자의 인증 정보를 확인하고, 사용자의 요청을 처리한다.

### 장점
1. 정보가 서버에 저장되기 때문에 토큰 기반 인증에 비해 위변조 혹은 손상 우려가 없다.

### 단점
1. 서비스의 규모가 커질수록 무리를 줄 수 있다.
2. 서비스의 규모가 커져서 사용자가 늘어나게 되면 더 많은 트래픽을 처리하기 위한 조치가 필요하다. 보통 서버를 확장하거나, 세션을 분산시키는 등 조치가 있는데, 세션을 사용할 경우 조치가 매우 복잡해진다.

## 토큰 기반 인증
![토큰 기반 인증](https://velog.velcdn.com/images%2Farthur%2Fpost%2Fb0248af5-1602-46e5-89c2-00a4fccf59c4%2F%ED%86%A0%ED%81%B0%EC%9D%B8%EC%A6%9D%EB%B0%A9%EC%8B%9D.png)

> 많은 웹 애플리케이션에서 JWT를 사용한다.

1. 서버는 아이디, 비밀번호 등으로 인증을 완료한 사용자에게 토큰을 발급한다.
2. 클라이언트는 토큰을 별도의 공간에 저장(localStorage, Cookie 등)한 후, 서버에 요청할 때 헤더에 토큰을 함께 보낸다.
3. 서버는 해당 JWT의 유효성을 검사하고 인가한다.

### 장점
1. JWT는 클라이언트 측에서 저장하므로 서버 메모리, DB에 부담을 주지 않으며, 서버는 완전히 무상태성(Stateless)이다.(서버에서 인증 상태를 유지하지 않으므로)

### 단점
1. JWT가 브라우저에 그대로 노출되어 있으므로 위변조, 손상의 위험이 크다.(XSS 공격)
2. 한 번 발급된 토큰은 임의로 만료시킬 수 없다. 따라서 토큰이 공격자에게 탈취되었다면, 공격자는 토큰이 만료될 때까지 계속 공격할 수 있다.

## 참고자료
- https://velog.io/@arthur/%EC%84%B8%EC%85%98-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D-vs-%ED%86%A0%ED%81%B0-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D
- https://fierycoding.tistory.com/69
